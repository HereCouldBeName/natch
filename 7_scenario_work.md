<div style="page-break-before:always;">
</div>

# <a name="record_replay"></a>7. Запись и воспроизведение сценариев

## 7.1. Запись сценария
## 7.2. Воспроизведение сценария

Полученные скрипты *run_record.sh* и *run_replay.h* применяются для работы с *Natch* для записи сценария работы виртуальной машины и воспроизведения соответственно.

С версии *Natch 2.3* предусмотрена работа с несколькими сценариями в рамках одного проекта, в связи с чем в скрипты записи и воспроизведения добавился некоторый интерактив.

При запуске скрипта *run_record.sh* будет запрошено имя сценария. В случае пропуска поля ввода, имя будет назначено автоматически (*record*).
Обратите внимание, что при указании одинаковых имен сценарии будут перезаписаны. Сценарии располагаются в отдельных папках с указанными пользователем названиями.
В каждую такую папку помещаются все необходимые для работы сценария файлы - журнал, оверлей, конфигурационный файл для помеченных данных, логи сетевых взаимодействий и т.д.
Именно в папке со сценарием будет находиться вторая часть основного конфигурационного файла (*taint.cfg*), который следует отредактировать перед воспроизведением.

При запуске скрипта *run_replay.sh* ситуация может разворачиваться несколькими способами:

* *У нас один сценарий и один снапшот*. В этом случае воспроизведение запустится и отработает без участия пользователя.
* *У нас один сценарий и несколько снапшотов*. Сценарий будет выбран по умолчанию, а для загрузки нужного снапшота нужно будет выбрать его из меню (с помощью стрелочек и клавиши Enter).
* *У нас несколько сценариев и один снапшот (для выбранного сценария)*. Для выбора сценария будет отображено меню с доступными сценариями, снапшот загрузится автоматически.
* *У нас несколько сценариев и несколько снапшотов (для выбранного сценария)*. В обоих случаях будет отображено меню.

Помимо этого скрипт *run_replay.sh* имеет два необязательных параметра *scenario_name* и *snapshot_name*. Например, если во время записи был создан сценарий с названием *sample* и в процессе работы был сохранен снапшот с именем *state*, то запустить воспроизведение с этого момента можно передав скрипту параметры ``./run_replay.sh sample state``. Обратите внимание, что требуется указывать оба параметра, в противном случае они будут проигнорированы, и скрипт будет вести себя как описано выше. Если во время работы снапшот не был сохранен, то следует указать имя стартового снапшота, а именно *init*.


Конфигурационный файл для помеченных данных генерируется при записи сценария и помещается в соответствующую директорию. Сделано это с целью сохранения настроек пометок для конкретного сценария в рамках одного проекта.


