<div style="page-break-before:always;">
</div>


# <a name="faq"></a>14. FAQ

В этом разделе собраны наиболее часто встречающиеся проблемы при работе с инструментами *Natch* и *SNatch*, раздел будет пополняться.

-----------------------------------------------------------------------------------

**Проблема**: настройка стенда происходит очень медленно

**Решение**: проверьте, используете ли вы опцию `enable-kvm` при запуске QEMU. Если вы хотите проверить включен ли KVM в уже запущенной виртуальной машине - введите в мониторе QEMU команду `info kvm`

-----------------------------------------------------------------------------------

**Проблема**: *Natch* не запускается

При запуске появляется сообщение *"Sentinel LDK Protection System: Sentinel key not found"*

**Решение**: проверьте наличие лицензии. Удостоверьтесь что используете подходящий вашему ключу дистрибутив.

-----------------------------------------------------------------------------------

**Проблема**: *Natch* завершается с ошибкой illegal instruction (недопустимая инструкция)

При возникновении ошибки illegal instruction (недопустимая инструкция), следует проверить совместимость
вашего процессора. Для этого выполните команду:

```
cat /proc/cpuinfo | grep -m1 flags | awk '/avx/ && /sse/ && /sse4_1/ && /sse4_2/'
```

Если вывод пустой, значит ваш процессор не подходит.

**Решение**: необходимо использовать процессор, поддерживающий расширения `avx`, `sse`, `sse4_1`, `sse4_2`.

-----------------------------------------------------------------------------------

**Проблема**: тюнинг работает слишком долго и ничего не происходит

**Решение**: подождите (чаще всего это и есть решение). Если ОС загрузилась, а настройка все еще идет, попробуйте поделать что-то, например, позапускать программы,
чтобы спровоцировать возникновение системных вызовов. В случае если вы используете экзотическую ОС и тюнинг не может быть выполнен, он завершится по таймауту
и вы получите сообщение о нештатном завершении настройки. В таком случае обратитесь к разработчику.

Так же тюнинг может быть выполнен не полностью, но если все обязательные параметры были обнаружены, скрипты сформируются и инструмент будет работать.

Для удобства пользователя внизу экрана отображается счетчик событий, по которому можно ориентироваться не нужна ли системе помощь извне.

-----------------------------------------------------------------------------------


**Проблема**: статистика помеченных данных показывает нули

**Решение**: чаще всего такая ситуация возникает, если источник помеченных данных был указан неверно или если работа с помеченными данными происходила до того как состояние машины было сохранено. Проверьте:

- указали ли вы нужные порты и/или файлы в конфигурационном файле `taint.cfg`
- выполнили ли команду `savevm` до того как поработали с помеченными данными

Если все верно, а статистика нулевая, возможно это баг :) Обратитесь к разработчику, пожалуйста.

-----------------------------------------------------------------------------------

**Проблема**: появилась необходимость перегенерировать `task.cfg`. Например, у вас есть проект и вы не хотите его пересоздавать, а версия конфигурационного файла `task.cfg` изменилась и *Natch* не запускается

**Решение**: в таком случае вы можете удалить старый файл и запустить `run_replay.sh`, в результате чего будет произведена попытка выполнить тюнинг. Эта ситуация может закончиться успехом, а может и нет, если журнал слишком короткий и все параметры не успеют обнаружиться. Решений может быть несколько.

Первый вариант:

- запустите `run_replay.sh` с параметрами `<scenario_name> init`. Таким образом ОС будет загружаться с начала и шансов что все пройдет удачно больше.

Более надежным способом будет отредактировать скрипт `run_qemu.sh`:

- удалите строку `-enable-kvm -cpu host,nx`
- допишите строку `-plugin natch` или `-plugin tuning_introspection` (запуск тюнинга напрямую)

Запустите скрипт. Дождитесь выполнения тюнинга.

-----------------------------------------------------------------------------------

**Проблема**: не установился *SNatch*

**Решение**: проверьте, что в названиях директорий, в которых вы находитесь, нет пробелов. Если есть, устраните проблему и перезапустите `snatch_setup.sh`.

-----------------------------------------------------------------------------------

**Проблема**: шкала прогресса "Processing surface" пропала до завершения обработки архива (например, после обновления страницы).

**Решение**: процесс обработки архива продолжается в фоне. При его завершении в консоли появится сообщение `Processing ___ is done!`

-----------------------------------------------------------------------------------

**Проблема**: Flame graph долго строится/завис

**Решение**: процесс построения флейм графа может занять очень длительное время, более часа.

При построении флейм графа выводится прогресс. Если же ждать все равно больше не хочется, процесс построения можно прервать с помощью кнопки `Generate`, которая краснеет при наведении мыши.

-----------------------------------------------------------------------------------

**Проблема**: во время экспорта проекта в PDF появляется сообщение об ошибке для какого-то из заданных параметров

**Решение**: вероятнее всего, сгенерированная для данного параметра (чаще всего это относится к ресурсам) таблица оказалась слишком большой для используемой библиотеки. В таком случае рекомендуется использование предлагаемых фильтров: включить "only tainted", чтобы в отчет попали только связанные с пометками данные, и отключить "include root", чтобы оставить только пользовательские процессы.

-----------------------------------------------------------------------------------

**Проблема**: на  Alt Linux, во время создания проекта после тюнинга на этапе сборки отладочной информации, возникают ошибки `FATAL: Error create mounted folder` и `FATAL: Error delete mounted folder`

**Решение**: убедитесь в том, что учетная запись root добавлена в sudoers.

-----------------------------------------------------------------------------------

**Проблема**: в ходе анализа сценариев работы многопроцессного программного комплекса, предназначенного для работы на многоядерных (многопроцессорных) платформах, запись сценария происходит очень медленно

**Решение**: в настоящий момент и в обозримой перспективе отсутствует. Запись сценария требует запуска эмулятора QEMU в режиме полносистемной эмуляции, подразумевающем выполнение всего исполняемого кода анализируемого программного комплекса (включая код среды его функционирования - ОС, BIOS, эмулированных устройств и т. п.) в виртуальном процессоре -- программной модели процессора (эмулятор QEMU работает в данном режиме по умолчанию, в случае если не указан ключ `enable-kvm`).

Скорость выполнения исполняемого кода в режиме полносистемной эмуляции намного ниже по сравнению с выполнением на аппаратном процессоре, однако позволяет логировать любые изменения состояния виртуального процессора, оперативной памяти, а также взаимодействия с внешними по отношению к эмулированному пространству сущностями (сеть и т. п.). В том числе это позволяет записывать и в дальнейшем воспроизводить работу виртуальной машины,
сохраняя в файл случайные и недетерминированные события, меняющие состояния виртуальной машины.

Добавление возможности надежного логирования работы даже двухядерной (двухпроцессорной) системы,
требует записывать ещё и порядок обращения процессоров к памяти, чтобы избежать состояния гонки при воспроизведении.
Такой лог будет на несколько порядков больше лога однопроцессорной машины, что делает запись/воспроизведение неприменимыми при существующих объёмах
и скоростях накопителей.

Реализация данного механизма на программном уровне является фундаментальной проблемой, до сих пор не имеющей в мире эффективного решения. Некоторые попытки решить аналогичную задачу для архитектуры x86_64 делались разработчиками процессоров, в частности компанией Intel, однако во-первых они не завершились удачными конкретными решениями, во-вторых -- требовали доработки процессора за счёт внесения в него отдельного специализированного блока, отвечающего за корректное логирование всех операций доступа -- то есть создания отдельное процессорной линейки. Таким образом в настоящий момент увеличение числа ядер виртуального процессора QEMU и запись сценариев в многоядерном (многопроцессорном) режиме не представляется возможным технологически.
