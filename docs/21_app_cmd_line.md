<div style="page-break-before:always;">
</div>

# <a name="natch_cmd_line"></a>Приложение 7. Изменение командной строки эмулятора

Командная строка, формируемая инструментом по умолчанию, не всегда может отвечать требованиям пользователя.
Для того чтобы расширить конфигурацию самостоятельно, предусмотрен файл с параметрами эмулятора, который
формируется при создании проекта и располагается в рабочей директории. Это файл `qemu_opts.ini`.
Подробнее про работу с этим файлом можно узнать в разделе
[Интерактивный режим создания проекта](6_create_project.md#natch_run_script).

В этом разделе рассмотрим несколько типичных ситуаций модификации командной строки запуска эмулятора.

Важно! При самостоятельной модификации параметров запуска эмулятора не гарантируется корректная работа команд из набора `natch set`.

## Добавление второго диска

## Добавить несколько сетевых адаптеров

По умолчанию используется один сетевой адаптер модели `e1000`, если вам нужно больше адаптеров,
можно их добавить. Обратите внимание, что анализ помеченных данных в *Natch* работает только на модели `e1000`.

Так как работа *Natch* предполагает детерминированное воспроизведение, просто добавить новое устройство
нельзя, нужно обеспечить его работу в режиме воспроизведения. Рассмотрим добавление еще одного сетевого
адаптера без проброса портов. Для этого откройте файл `qemu_opts.ini` на редактирование, найдите упоминание
`netdev`:

```
-netdev user,id=net0
-device e1000,netdev=net0
[rr]-object filter-replay,id=replay,netdev=net0
```
В таком простом случае обратить внимание нужно на последнюю строчку, которая добавляет фильтр для режимов записи и
воспроизведения. Добавить еще одно такое же устройство можно просто изменив поля `id`:
```
-netdev user,id=net0
-device e1000,netdev=net0
[rr]-object filter-replay,id=replay,netdev=net0
-netdev user,id=net1
-device e1000,netdev=net1
[rr]-object filter-replay,id=replay1,netdev=net1
```
Теперь в нашей конфигурации два сетевых адаптера и воспроизведение будет работать.

Когда в конфигурации присутствуют проброшенные порты, строк страновится больше:
```
[kvm]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:5555
[tuning]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:5555
[record]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:5555
[replay]-netdev user,id=net0
-device e1000,netdev=net0
[rr]-object filter-replay,id=replay,netdev=net0
```

Проброс портов должен фигурировать во всех возможных режимах работы эмулятора, кроме воспроизведения.
Видим, что для режимов записи и воспроизведения строки разные, поэтому уже нельзя использовать метку `[rr]`.
В то время как фильтр так и остается для `[rr]`.

Однако, если использовать режимы тюнинга и аппаратной виртуализации не планируется, строки можно
опустить. Как и в предыдущем примере, необходимо изменить `id`, а так же указать порты для проброса.

## Пробросить ssh

Со стороны эмулятора необходимо организовать проброску порта для подключения по ssh (порт 22 по умолчанию,
либо который установлен у вас). Сделать это можно на этапе создания проекта в разделе про сеть.
Укажите порт 22 для пробрасывания, а снаружи можно будет подключаться по выданному порту (от 49152,
в зависимости от количества портов в списке).

Если пробрасывался только порт 22, в `qemu_opts.ini` появятся записи вида:
```
[kvm]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:22
[tuning]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:22
[record]-netdev user,id=net0,hostfwd=tcp:127.0.0.1:49152-:22
[replay]-netdev user,id=net0
```

Если на этапе создания проекта вы отказались от пробрасываения портов, можно воспрользоваться командой
`natch set port 22` и необходимые измнения будут внесены автоматически как в `qemu_opts.ini` так и в
конфигурационные файлы сценариев, если они были выбраны.

<!-- вместо этого сдлать раздел с расширениями опций куэму -->
<!--
как поменять дисковое устройство
как добавить второй диск
как пробросить ssh
как добавить несколько сетевых адаптеров -->